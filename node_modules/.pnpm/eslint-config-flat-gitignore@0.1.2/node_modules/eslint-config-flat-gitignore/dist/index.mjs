import fs from 'node:fs';
import parse from 'parse-gitignore';

function ignore(options = {}) {
  const ignores = [];
  const {
    files: _files = ".gitignore",
    strict = true
  } = options;
  const files = Array.isArray(_files) ? _files : [_files];
  for (const file of files) {
    let content;
    try {
      content = fs.readFileSync(file, "utf8");
    } catch (error) {
      if (strict)
        throw error;
      continue;
    }
    const parsed = parse(`${content}
`);
    const globs = parsed.globs();
    for (const glob of globs) {
      if (glob.type === "ignore")
        ignores.push(...glob.patterns);
      else if (glob.type === "unignore")
        ignores.push(...glob.patterns.map((pattern) => `!${pattern}`));
    }
  }
  return {
    ignores
  };
}

export { ignore as default };
